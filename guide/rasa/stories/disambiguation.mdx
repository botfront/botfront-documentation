---
name: Disambiguating user input
route: /docs/rasa/disambiguation/
menu: Authoring conversations
meta:
  - name: description
    content: Disambiguate user input.
  - name: keywords
    content: rasa disambiguation fallback
permalink: /rasa/:slug
---

# Disambiguating user input

When your virtual assistant receives a user utterance, it calculates, for each intent in your domain, the confidence that the utterance is an instance of that intent. Sooner or later, your virtual assistant will be faced with utterances where none of the calculated confidences are particularly high.

Itâ€™s very often best to treat these cases separately, since it may mean that your virtual assistant does not understand, or is unsure. Within the Rasa framework, this is done using [policies](https://rasa.com/docs/rasa/core/policies/).

### Note: Automatic generation of suggestion button titles

Botfront introduces the notion of ["canonical" training examples](LINK-TO-DOCS), which provide a canonical human-readable text for intent labels. The Botfront Disambiguation Policy uses canonical status to provide localized text for the suggestion buttons shown to users during disambiguation. In order to enable this feature, the NLU pipeline for each language model needs to be extended in the following way:

```yaml
pipeline:
  ...
  - name: rasa_addons.nlu.components.intent_ranking_canonical_example_injector.IntentRankingCanonicalExampleInjector
  ...
```

This NLU component enriches the ``intent_ranking`` key of user messages in the tracker with canonical text, so that the Disambiguation Policy may pick it up. If the NLU component is not used, buttons will have the intent name as their title.

### Example usage

```yaml
policies:
  ...
  - name: rasa_addons.core.policies.BotfrontDisambiguationPolicy
    fallback_trigger: 0.30
    disambiguation_trigger: '$0 < 2 * $1'
    disambiguation_template: 'utter_disambiguation'
    n_suggestions: 2
    excluded_intents:
      - ^chitchat\..*
      - ^basics\..*
  ...
```

### Parameters

| Parameter                | What it does                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | type     |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| `fallback_trigger`       | If confidence of top-ranking intent is below this threshold, fallback is triggered. Fallback is an action that utters the template `utter_fallback` and returns to the previous conversation state.                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string` |
| `disambiguation_trigger` | Default: `'$0 < 2 * $1'` If this expression holds, disambiguation is triggered. (If it has already been triggered on the previous turn, fallback is triggered instead.) Here this expression resolves to "the score of the top-ranking intent is below twice the score of the second-ranking intent". Disambiguation is an action that lets the user to choose from the top-ranking intents using a button prompt. | `string` |
| `disambiguation_template`       | A response name resolving to a template containing a ``text`` field with a message, e.g. "I could not quite understand. Did you mean...". Any ``button`` included under the buttons field of this template will also appear at the end of autogenerated suggestions, e.g. ``{"title": "None of the above", "type": "postback", "payload": "/deny_suggestions"}``. | `string` |
| `n_suggestions`       | The maximum number of suggestions to display (excluding the 'Other' options).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `int` |
| `excluded_intents`       | Any intent (exactly) matching one of these regular expressions will not be shown as a suggestion.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `string` |
